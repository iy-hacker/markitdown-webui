# Markitdown WebUI

Markitdown ライブラリを使用してファイルや URL を Markdown 形式に変換し、ローカルフォルダに保存するための Web アプリケーションです。

## 機能概要

-   **ファイル変換**: ドキュメント(.docx, .xlsx, .pptx, .pdf, .txt など)を Markdown に変換
-   **URL 変換**: Web ページの URL を指定して Markdown に変換
-   **YouTube 対応**: YouTube の動画 URL を指定した場合、字幕(ja)を取得して変換
-   **フォルダ管理**: 変換結果の保存先フォルダを作成・編集・削除
-   **タスクキュー**: 非同期処理によるバックグラウンド変換とリアルタイム状態表示
-   **ダークモード**: UI のダークモード切替機能
-   **レイアウト切替**: 垂直/水平レイアウトの切替

## 技術スタック

-   **バックエンド**: Python、Flask
-   **フロントエンド**: HTML、CSS、JavaScript (バニラ JS)
-   **変換エンジン**: Markitdown ライブラリ
-   **タスク管理**: カスタム TaskQueue ライブラリ

## 必要条件

-   Python 3.8 以上

## インストール方法

```bash
python -m venv .venv
.\.venv\Scripts\activate

# 必要なライブラリをインストール
pip install -r requirements.txt

# アプリケーションを実行
python app.py
```

## 使用方法

1. ブラウザで `http://localhost:5000` にアクセス
2. 保存先フォルダを選択（または新規作成）
3. ファイルをドラッグ＆ドロップするか、クリックしてファイルを選択
4. または、URL を入力して「追加」ボタンをクリック
5. タスクキューセクションで変換の進行状況を確認
6. 変換が完了したファイルは `./output/{選択したフォルダ}` ディレクトリに保存されます

### ファイル命名規則

-   ファイル変換の場合: `入力ファイル名.{変換年月日}.md`
-   URL 変換の場合: `サイトタイトル.{変換年月日}.md`

## フォルダ構造

```
markitdown-webapp/
├── app.py                  # メインのFlaskアプリケーション
├── config.py               # 設定ファイル
├── taskqueue/              # taskqueueライブラリ
│   ├── __init__.py
│   ├── exceptions.py
│   ├── queue.py
│   ├── task.py
├── handlers/
│   ├── __init__.py
│   └── conversion_handler.py  # 変換処理ハンドラ
├── static/                 # 静的ファイル
│   ├── css/
│   │   └── styles.css
│   ├── js/
│   │   └── scripts.js
├── templates/              # テンプレート
│   └── index.html
├── output/                 # 変換結果の出力ディレクトリ
│   ├── default/
│   ├── report/
│   └── document/
├── temp/                   # 一時ファイル保存用
└── requirements.txt        # 依存パッケージ
```

## TaskQueue ライブラリについて

このアプリケーションでは、非同期タスク処理のためにカスタム TasQueue ライブラリを使用しています。このライブラリは`concurrent.futures.ThreadPoolExecutor`をベースにした軽量のタスクキュー実装で、以下の機能を提供します：

-   タスクの登録と非同期実行
-   タスク状態の監視（待機中、処理中、完了、エラー）
-   タスク処理用ハンドラーの登録
-   タスク単位のワーカー数指定

## 開発者向け情報

### カスタム変換ハンドラーの追加

新しい変換機能を追加する場合は、`handlers`フォルダに新しいハンドラーファイルを作成し、`app.py`でハンドラーを登録します：

```python
# 新しいハンドラーをインポート
from handlers.my_new_handler import handle_my_new_task

# ハンドラーを登録
task_queue.register_handler('my_new_task_type', handle_my_new_task)
```

### タスクキューの拡張

タスクキューの機能を拡張する場合は、`taskqueue`パッケージ内のファイルを編集します。例えば、優先度ベースのタスク処理を追加する場合は、`queue.py`を修正します。

## ライセンス

このプロジェクトは [MIT ライセンス](LICENSE) の下で公開されています。

## 注意事項

-   このアプリケーションはローカルネットワーク内での使用を想定しています。
-   大きなファイル（16MB 以上）はデフォルトでは処理できません。必要に応じて`config.py`の`MAX_CONTENT_LENGTH`を調整してください。
-   処理されたファイルはすべてローカルに保存されます。クラウドストレージとの連携は実装されていません。

---

© 2025 Markitdown WebUI

=================
では、改善した JavaScript コードを実装して、UI 機能とインタラクションを向上させましょう。

次に、便利なファビコンを作成してユーザーインターフェイスをさらに向上させましょう。

最後に、`run.py`ファイルを作成して、Uvicorn で Flask アプリを実行するための設定を追加します。

これで、Markitdown WebUI の大幅な改善が完了しました。以下に実装した主な改善点をまとめます。

## 実装した改善点

### 1. コマンドライン引数のサポート

-   `app.py`と`run.py`にコマンドライン引数のパース機能を実装
-   出力ディレクトリを指定できるようになり、`python app.py "保存先フォルダのpath"`の形式で実行可能

### 2. UI/UX の改善

-   **アクセシビリティ**：WAI-ARIA に準拠したマークアップで、スクリーンリーダー対応を強化
-   **レスポンシブデザイン**：様々な画面サイズに対応するレイアウト
-   **ダークモード**：ユーザーの好みに応じたダークモード対応
-   **モダンなデザイン**：カラーパレット、余白、アニメーションを最適化

### 3. 機能拡張

-   **ファイルエクスプローラー**：変換済みファイルを閲覧可能
-   **マークダウンプレビュー**：変換されたファイルをブラウザ内で直接プレビュー
-   **タスクフィルター**：状態や検索でタスクを絞り込み可能
-   **トースト通知**：操作結果や重要な情報を通知

### 4. HTML/CSS 中心のインタラクション

-   `<details>`要素を使用したアコーディオン
-   CSS トランジションを活用した視覚効果
-   CSS ベースのタブインターフェース
-   フォームバリデーションの強化

### 5. 安定性向上

-   エラーハンドリングの改善
-   非同期処理の安定性向上
-   Uvicorn を使用した WSGI アプリケーションの実行サポート

## 使用方法

1. 通常の起動:

```bash
python app.py
```

2. カスタム出力ディレクトリの指定:

```bash
python app.py /path/to/output/directory
```

3. Uvicorn を使用した起動:

```bash
python run.py [出力ディレクトリのパス]
```

4. ポートやホストのカスタマイズ:

```bash
python run.py -p 8080 -H localhost /path/to/output/directory
```
